---
title: "Course Assignment"
author: "Moritz KÃ¶rber"
date: "15 Juli 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

First step: Load required packages.

```{r message=FALSE, warning=FALSE}
library("dplyr")
library("caret")
library("mlr")
library("visdat")
```

Load data and set seed:

```{r}
df <- read.csv("1_data/pml-training.csv", na.strings = c("NA", "NaN", "", "#DIV/0!"), row.names = 1)

set.seed(31)
```


# 1. Inspect target variable
First, I am looking at the target variable "classe":

```{r echo=FALSE}
# What is "classe"?
glimpse(df$classe)
```

Since it is a categorical variable, it is a classification problem. Hence, an algorithm like logistic regression, random forests, or a similar algorithm is suitable. 

# 2. Clean the data set
Remove obvious non-predictive variables:
```{r crop predictors without any information, echo=T}
df %>% select(-c(raw_timestamp_part_1, raw_timestamp_part_2, cvtd_timestamp)) -> df
```

Remove zero variance/near zero variance predictors
```{r}
nzv <- nearZeroVar(df)
df <- df[-nzv]

df <- removeConstantFeatures(df, perc = .02)
```

Remove predictors with mostly NAs:
```{r message=FALSE, warning=FALSE}
df %>%
  select(everything()) %>%
  summarise_all(funs(sum(is.na(.)) / length(.))) -> p

# check these variables
vis_miss(df[which(p > 0.975)],
  sort_miss = TRUE, warn_large_data = F
)

# remove them if sensible
df[which(p > 0.975)] <- NULL
```

Remove highly correlated predictors
```{r}
nums <- select_if(df, is.numeric)
descrCor <- cor(nums)

highCorr <- sum(na.omit(abs(descrCor[upper.tri(descrCor)])) >= .98)

na.omit(descrCor[upper.tri(descrCor)])[which(na.omit(abs(descrCor[upper.tri(descrCor)])) >= .98, arr.ind = TRUE)]

which(na.omit(abs(descrCor)) >= .98 & na.omit(abs(descrCor)) < 1, arr.ind = TRUE)

findCorrelation(na.omit(descrCor), cutoff = .98, verbose = T, exact = T, names = T)
```

There are two variables with high correlation --> consider in model evaluation! I will leave them in the dataset for this time.

Find linear combinations:
```{r}
findLinearCombos(nums)
```

Visualize the data:
```{r}
vis_dat(df, warn_large_data = F)
```

Are mixed data types in one variable?
```{r}
vis_guess(df)
```

Plot the features:
```{r}
nums <- unlist(lapply(df, is.numeric))
featurePlot(x = df[nums], y = df$classe, plot = "strip")
```

Save the cleaned data
```{r eval = FALSE}
saveRDS(df, "1_data/cleaned_data.rds")
```

